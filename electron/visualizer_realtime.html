<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      background: transparent;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }
    
    .visualizer-container {
      width: 120px;
      height: 40px;
      background: rgba(0, 0, 0, 0.9);
      border-radius: 6px;
      padding: 6px;
      backdrop-filter: blur(10px);
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    canvas {
      width: 100%;
      height: 28px;
    }
  </style>
</head>
<body>
  <div class="visualizer-container">
    <canvas id="visualizer"></canvas>
  </div>
  
  <script>
    const { ipcRenderer } = require('electron');
    const canvas = document.getElementById('visualizer');
    const ctx = canvas.getContext('2d');
    
    canvas.width = 108;
    canvas.height = 28;
    
    let isRecording = false;
    let animationId = null;
    let audioLevel = 0;
    let bars = [];
    const barCount = 30;
    const barWidth = canvas.width / barCount;
    const barGap = 1;
    
    for (let i = 0; i < barCount; i++) {
      bars.push({
        height: 2,
        targetHeight: 2,
        velocity: 0
      });
    }
    
    function animate() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      for (let i = 0; i < barCount; i++) {
        const bar = bars[i];
        
        if (isRecording) {
          // Use actual audio level for center bars, random variation for edges
          const distFromCenter = Math.abs(i - barCount/2) / (barCount/2);
          const levelInfluence = 1 - distFromCenter * 0.5;
          bar.targetHeight = 2 + (audioLevel * canvas.height * levelInfluence) + Math.random() * 5;
          bar.velocity += (bar.targetHeight - bar.height) * 0.15;
          bar.velocity *= 0.75;
        } else {
          // Smooth wave animation when processing
          const wave = Math.sin((Date.now() / 1000 + i * 0.1) * 2) * 0.5 + 0.5;
          bar.targetHeight = 4 + wave * 12;
          bar.velocity += (bar.targetHeight - bar.height) * 0.05;
          bar.velocity *= 0.85;
        }
        
        bar.height += bar.velocity;
        bar.height = Math.max(2, Math.min(canvas.height - 2, bar.height));
        
        const x = i * barWidth;
        const y = (canvas.height - bar.height) / 2;
        
        ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
        ctx.fillRect(x + barGap/2, y, barWidth - barGap, bar.height);
      }
      
      animationId = requestAnimationFrame(animate);
    }
    
    ipcRenderer.on('recording-start', () => {
      isRecording = true;
      audioLevel = 0;
    });
    
    ipcRenderer.on('recording-stop', () => {
      isRecording = false;
    });
    
    ipcRenderer.on('audio-level', (event, level) => {
      audioLevel = Math.min(1, level);
    });
    
    animate();
  </script>
</body>
</html>