<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Transcript History</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: #1e1e1e;
      color: #e0e0e0;
      display: flex;
      flex-direction: column;
      height: 100vh;
      user-select: none;
    }
    
    .header {
      padding: 20px;
      background: #2d2d2d;
      border-bottom: 1px solid #3e3e3e;
      -webkit-app-region: drag;
      padding-top: 30px;
    }
    
    .header h1 {
      font-size: 24px;
      font-weight: 500;
      margin-bottom: 10px;
    }
    
    .controls {
      display: flex;
      gap: 10px;
      -webkit-app-region: no-drag;
    }
    
    button {
      padding: 8px 16px;
      background: #3e3e3e;
      color: #e0e0e0;
      border: none;
      border-radius: 6px;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    button:hover {
      background: #4a4a4a;
    }
    
    button:active {
      transform: scale(0.98);
    }
    
    button.primary {
      background: #007AFF;
      color: white;
    }
    
    button.primary:hover {
      background: #0066d6;
    }
    
    .transcripts-container {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
    }
    
    .transcript-item {
      background: #2d2d2d;
      border: 1px solid #3e3e3e;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 10px;
      transition: all 0.2s;
      cursor: pointer;
      user-select: text;
    }
    
    .transcript-item:hover {
      background: #353535;
      border-color: #4a4a4a;
    }
    
    .transcript-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      user-select: none;
    }
    
    .transcript-time {
      font-size: 12px;
      color: #808080;
    }
    
    .transcript-actions {
      display: flex;
      gap: 8px;
    }
    
    .action-btn {
      padding: 4px 8px;
      background: transparent;
      color: #808080;
      border: 1px solid #3e3e3e;
      border-radius: 4px;
      font-size: 11px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .action-btn:hover {
      color: #e0e0e0;
      border-color: #4a4a4a;
      background: #3e3e3e;
    }
    
    .action-btn.delete:hover {
      color: #ff4444;
      border-color: #ff4444;
    }
    
    .transcript-text {
      font-size: 14px;
      line-height: 1.5;
      color: #d0d0d0;
      word-wrap: break-word;
      max-height: 100px;
      overflow: hidden;
      position: relative;
    }
    
    .transcript-text.expanded {
      max-height: none;
    }
    
    .transcript-text::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 30px;
      background: linear-gradient(transparent, #2d2d2d);
    }
    
    .transcript-text.expanded::after {
      display: none;
    }
    
    .empty-state {
      text-align: center;
      padding: 40px;
      color: #808080;
    }
    
    .empty-state h2 {
      font-size: 18px;
      margin-bottom: 10px;
      font-weight: 400;
    }
    
    .empty-state p {
      font-size: 14px;
    }
    
    ::-webkit-scrollbar {
      width: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: #2d2d2d;
    }
    
    ::-webkit-scrollbar-thumb {
      background: #4a4a4a;
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: #5a5a5a;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>Transcript History</h1>
    <div class="controls">
      <button onclick="refreshTranscripts()">Refresh</button>
      <button onclick="openFolder()">Open Folder</button>
      <button onclick="clearAll()" style="color: #ff4444;">Clear All</button>
    </div>
  </div>
  
  <div class="transcripts-container" id="transcripts">
    <div class="empty-state">
      <h2>No transcripts yet</h2>
      <p>Your transcripts will appear here after recording</p>
    </div>
  </div>
  
  <script>
    const { ipcRenderer, clipboard } = require('electron');
    let transcripts = [];
    
    function formatDate(date) {
      const d = new Date(date);
      const today = new Date();
      const yesterday = new Date(today);
      yesterday.setDate(yesterday.getDate() - 1);
      
      let dateStr;
      if (d.toDateString() === today.toDateString()) {
        dateStr = 'Today';
      } else if (d.toDateString() === yesterday.toDateString()) {
        dateStr = 'Yesterday';
      } else {
        dateStr = d.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
      }
      
      const timeStr = d.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true });
      return `${dateStr} at ${timeStr}`;
    }
    
    function renderTranscripts() {
      const container = document.getElementById('transcripts');
      
      if (transcripts.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <h2>No transcripts yet</h2>
            <p>Your transcripts will appear here after recording</p>
          </div>
        `;
        return;
      }
      
      container.innerHTML = transcripts.map((t, index) => `
        <div class="transcript-item" data-index="${index}">
          <div class="transcript-header">
            <span class="transcript-time">${formatDate(t.timestamp)}</span>
            <div class="transcript-actions">
              <button class="action-btn" onclick="copyTranscript(${index})">Copy</button>
              <button class="action-btn delete" onclick="deleteTranscript(${index})">Delete</button>
            </div>
          </div>
          <div class="transcript-text" onclick="toggleExpand(this)">
            ${escapeHtml(t.text)}
          </div>
        </div>
      `).join('');
    }
    
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
    
    function toggleExpand(element) {
      element.classList.toggle('expanded');
    }
    
    function copyTranscript(index) {
      clipboard.writeText(transcripts[index].text);
      event.stopPropagation();
    }
    
    async function deleteTranscript(index) {
      event.stopPropagation();
      const t = transcripts[index];
      await ipcRenderer.invoke('delete-transcript', t.filename);
      transcripts.splice(index, 1);
      renderTranscripts();
    }
    
    async function refreshTranscripts() {
      transcripts = await ipcRenderer.invoke('get-transcripts');
      renderTranscripts();
    }
    
    async function openFolder() {
      await ipcRenderer.invoke('open-transcript-folder');
    }
    
    async function clearAll() {
      if (confirm('Are you sure you want to delete all transcripts?')) {
        for (const t of transcripts) {
          await ipcRenderer.invoke('delete-transcript', t.filename);
        }
        transcripts = [];
        renderTranscripts();
      }
    }
    
    ipcRenderer.on('new-transcript', (event, transcript) => {
      transcripts.unshift(transcript);
      renderTranscripts();
    });
    
    refreshTranscripts();
  </script>
</body>
</html>